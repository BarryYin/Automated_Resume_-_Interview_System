<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HRç®¡ç†æ§åˆ¶å°</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/pdf-viewer.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- å¤´éƒ¨ -->
        <div class="dashboard-header">
            <div class="header-left">
                <button class="back-btn" onclick="goHome()">â† è¿”å›é¦–é¡µ</button>
                <h1>HR ç®¡ç†æ§åˆ¶å°</h1>
            </div>
            <button class="create-btn" onclick="createNewPosition()">+ åˆ›å»ºæ–°èŒä½</button>
        </div>
        
        <!-- å¯¼èˆªæ ‡ç­¾ -->
        <div class="dashboard-nav">
            <button class="nav-btn active" data-tab="positions" onclick="switchTab('positions')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                </svg>
                å²—ä½ç®¡ç†
            </button>
            <button class="nav-btn" data-tab="candidates" onclick="switchTab('candidates')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2.5l-2.54-7.63A3.01 3.01 0 0 0 17.1 7H16c-.8 0-1.54.37-2.03.97L12 10l-1.97-2.03A2.99 2.99 0 0 0 8 7H6.9c-1.3 0-2.44.84-2.86 2.37L1.5 16H4v6h2v-6h2.5l2.5-3 2.5 3H16v6h4z"/>
                </svg>
                å€™é€‰äºº
            </button>
            <button class="nav-btn" data-tab="analytics" onclick="switchTab('analytics')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                </svg>
                æ•°æ®åˆ†æ
            </button>
        </div>
        
        <!-- å²—ä½ç®¡ç†å†…å®¹ -->
        <div id="positions-content" class="tab-content active">
            <div class="content-header">
                <h2>æ‹›è˜å²—ä½åˆ—è¡¨</h2>
                <p class="content-subtitle">ç®¡ç†æ‰€æœ‰æ‹›è˜å²—ä½å’Œå€™é€‰äºº</p>
            </div>
            
            <div class="positions-list">
                <div class="position-card">
                    <div class="position-header">
                        <div class="position-info">
                            <h3>é«˜çº§å‰ç«¯å·¥ç¨‹å¸ˆ</h3>
                            <span class="position-status recruiting">æ‹›è˜ä¸­</span>
                        </div>
                        <div class="position-actions">
                            <button class="action-btn view" onclick="viewPosition('frontend')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                                </svg>
                                æŸ¥çœ‹
                            </button>
                            <button class="action-btn edit" onclick="editPosition('frontend')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                </svg>
                            </button>
                            <button class="action-btn delete" onclick="deletePosition('frontend')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="position-details">
                        <div class="detail-item">
                            <span class="label">æŠ€æœ¯éƒ¨</span>
                            <span class="value">è–ªèµ„: Â¥20,000 - Â¥35,000</span>
                            <span class="value">12 ä½å€™é€‰äºº</span>
                            <span class="value">å‘å¸ƒäº 2025-01-15</span>
                        </div>
                    </div>
                </div>
                
                <div class="position-card">
                    <div class="position-header">
                        <div class="position-info">
                            <h3>äº§å“ç»ç†</h3>
                            <span class="position-status recruiting">æ‹›è˜ä¸­</span>
                        </div>
                        <div class="position-actions">
                            <button class="action-btn view" onclick="viewPosition('pm')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                                </svg>
                                æŸ¥çœ‹
                            </button>
                            <button class="action-btn edit" onclick="editPosition('pm')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                </svg>
                            </button>
                            <button class="action-btn delete" onclick="deletePosition('pm')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="position-details">
                        <div class="detail-item">
                            <span class="label">äº§å“éƒ¨</span>
                            <span class="value">è–ªèµ„: Â¥18,000 - Â¥30,000</span>
                            <span class="value">8 ä½å€™é€‰äºº</span>
                            <span class="value">å‘å¸ƒäº 2025-01-20</span>
                        </div>
                    </div>
                </div>
                
                <div class="position-card">
                    <div class="position-header">
                        <div class="position-info">
                            <h3>Pythonå·¥ç¨‹å¸ˆæœåŠ¡å™¨ç«¯å¼€å‘</h3>
                            <span class="position-status recruiting">æ‹›è˜ä¸­</span>
                        </div>
                        <div class="position-actions">
                            <button class="action-btn view" onclick="viewPosition('python')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                                </svg>
                                æŸ¥çœ‹
                            </button>
                            <button class="action-btn edit" onclick="editPosition('python')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                </svg>
                            </button>
                            <button class="action-btn delete" onclick="deletePosition('python')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="position-details">
                        <div class="detail-item">
                            <span class="label">æŠ€æœ¯éƒ¨</span>
                            <span class="value">è–ªèµ„: Â¥15,000 - Â¥25,000</span>
                            <span class="value">6 ä½å€™é€‰äºº</span>
                            <span class="value">å‘å¸ƒäº 2025-01-18</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å€™é€‰äººå†…å®¹ -->
        <div id="candidates-content" class="tab-content">
            <div class="content-header">
                <div class="header-title">
                    <h2>å€™é€‰äººåˆ—è¡¨</h2>
                    <p class="content-subtitle">æŸ¥çœ‹æ‰€æœ‰å€™é€‰äººçš„é¢è¯•æƒ…å†µå’Œè¯„åˆ†</p>
                </div>
                <button class="create-btn" onclick="addCandidate()">+ æ·»åŠ å€™é€‰äºº</button>
            </div>
            
            <div class="content-body">
                <div class="search-filter">
                    <div class="search-box">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        </svg>
                        <input type="text" placeholder="æœç´¢å€™é€‰äººå§“åæˆ–é‚®ç®±..." id="candidateSearch">
                    </div>
                    <select class="filter-select" id="statusFilter">
                        <option value="all">å…¨éƒ¨çŠ¶æ€</option>
                        <option value="completed">å·²å®Œæˆ</option>
                        <option value="in-progress">é¢è¯•ä¸­</option>
                        <option value="pending">å¾…é¢è¯•</option>
                    </select>
                </div>
                
                <div class="candidates-list">
                    <!-- å€™é€‰äººæ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                    <div class="loading-message">æ­£åœ¨åŠ è½½å€™é€‰äººæ•°æ®...</div>
                </div>
            </div>
        </div>
        
        <!-- æ•°æ®åˆ†æå†…å®¹ -->
        <div id="analytics-content" class="tab-content">
            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“‹</div>
                    <div class="stat-content">
                        <div class="stat-number" id="analyticsActivePositions">12</div>
                        <div class="stat-label">æ´»è·ƒèŒä½</div>
                        <div class="stat-change">è¾ƒä¸Šæœˆ +2</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">ğŸ‘¥</div>
                    <div class="stat-content">
                        <div class="stat-number" id="analyticsTotalCandidates">156</div>
                        <div class="stat-label">æ€»å€™é€‰äºº</div>
                        <div class="stat-change">è¾ƒä¸Šæœˆ +23</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">âœ…</div>
                    <div class="stat-content">
                        <div class="stat-number" id="analyticsCompletedInterviews">89</div>
                        <div class="stat-label">å·²å®Œæˆé¢è¯•</div>
                        <div class="stat-change">å®Œæˆç‡ 57%</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“Š</div>
                    <div class="stat-content">
                        <div class="stat-number" id="analyticsAverageScore">78.5</div>
                        <div class="stat-label">å¹³å‡å¾—åˆ†</div>
                        <div class="stat-change">è¾ƒä¸Šæœˆ +3.2</div>
                    </div>
                </div>
            </div>

            <!-- åˆ†æå†…å®¹åŒºåŸŸ -->
            <div class="analytics-main">
                <!-- æœ€è¿‘ä¸¤å¤©æœ€ç¬¦åˆçš„å€™é€‰äºº -->
                <div class="analytics-section">
                    <h2>æœ€è¿‘ä¸¤å¤©æœ€ç¬¦åˆçš„å€™é€‰äºº</h2>
                    <p class="section-subtitle">æ ¹æ® AI è¯„åˆ†å’ŒåŒ¹é…åº¦æ’åº</p>
                    
                    <div class="candidates-ranking">
                        <!-- åŠ¨æ€åŠ è½½çš„æœ€ä½³å€™é€‰äººæ•°æ® -->
                        <div class="loading-message">æ­£åœ¨åŠ è½½æœ€ä½³å€™é€‰äººæ•°æ®...</div>
                    </div>
                </div>

                <!-- è–ªèµ„è¦æ±‚æœ€ä½çš„å€™é€‰äºº -->
                <div class="analytics-section">
                    <h2>è–ªèµ„è¦æ±‚æœ€ä½çš„å€™é€‰äºº</h2>
                    <p class="section-subtitle">æŒ‰å²—ä½åˆ†ç±»æ˜¾ç¤º</p>
                    
                    <div class="salary-ranking">
                        <!-- åŠ¨æ€åŠ è½½çš„æœ€ä½è–ªèµ„å€™é€‰äººæ•°æ® -->
                        <div class="loading-message">æ­£åœ¨åŠ è½½æœ€ä½è–ªèµ„å€™é€‰äººæ•°æ®...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ™ºèƒ½å¯¹è¯æŒ‰é’® -->
        <div class="chat-fab" onclick="toggleAIChat()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
            </svg>
        </div>

        <!-- AIå¯¹è¯ä¾§è¾¹æ  -->
        <div class="ai-chat-sidebar" id="aiChatSidebar">
            <div class="chat-header">
                <h3>AIæ•°æ®åˆ†æåŠ©æ‰‹</h3>
                <button class="close-chat" onclick="toggleAIChat()">Ã—</button>
            </div>
            <div class="chat-messages" id="aiChatMessages">
                <div class="ai-message">
                    <div class="message-content">
                        <div class="message-text">æ‚¨å¥½ï¼æˆ‘æ˜¯AIæ•°æ®åˆ†æåŠ©æ‰‹ï¼Œå¯ä»¥å¸®æ‚¨åˆ†ææ‹›è˜æ•°æ®ã€ç”ŸæˆæŠ¥å‘Šæˆ–å›ç­”ç›¸å…³é—®é¢˜ã€‚è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ</div>
                        <div class="message-time">åˆšåˆš</div>
                    </div>
                </div>
            </div>
            <div class="chat-input-area">
                <div class="quick-questions">
                    <button class="quick-btn" onclick="askQuickQuestion('åˆ†æå€™é€‰äººæ•´ä½“è¡¨ç°')">åˆ†æå€™é€‰äººæ•´ä½“è¡¨ç°</button>
                    <button class="quick-btn" onclick="askQuickQuestion('ç”Ÿæˆæ‹›è˜æ•ˆç‡æŠ¥å‘Š')">ç”Ÿæˆæ‹›è˜æ•ˆç‡æŠ¥å‘Š</button>
                    <button class="quick-btn" onclick="askQuickQuestion('å¯¹æ¯”å„èŒä½æ•°æ®')">å¯¹æ¯”å„èŒä½æ•°æ®</button>
                </div>
                <div class="report-actions">
                    <button class="report-btn" onclick="generateAndDownloadReport()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                        ç”Ÿæˆå®Œæ•´æŠ¥å‘Š
                    </button>
                    <button class="report-btn email" onclick="showEmailReportModal()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                        </svg>
                        é‚®ä»¶å‘é€æŠ¥å‘Š
                    </button>
                </div>
                <div class="input-container">
                    <input type="text" id="aiChatInput" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜..." onkeypress="handleChatKeyPress(event)">
                    <button onclick="sendAIMessage()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- é®ç½©å±‚ -->
        <div class="chat-overlay" id="chatOverlay" onclick="toggleAIChat()"></div>

        <!-- é‚®ä»¶å‘é€æ¨¡æ€æ¡† -->
        <div class="email-modal" id="emailModal">
            <div class="email-modal-content">
                <div class="email-header">
                    <h3>å‘é€æ‹›è˜åˆ†ææŠ¥å‘Š</h3>
                    <button class="close-email" onclick="closeEmailModal()">Ã—</button>
                </div>
                <form id="emailReportForm">
                    <div class="form-group">
                        <label for="recipientEmail">æ”¶ä»¶äººé‚®ç®±</label>
                        <input type="email" id="recipientEmail" required placeholder="manager@company.com">
                    </div>
                    <div class="form-group">
                        <label for="emailSubject">é‚®ä»¶ä¸»é¢˜</label>
                        <input type="text" id="emailSubject" value="æ‹›è˜æ•°æ®åˆ†ææŠ¥å‘Š" required>
                    </div>
                    <div class="form-group">
                        <label for="reportType">æŠ¥å‘Šç±»å‹</label>
                        <select id="reportType">
                            <option value="comprehensive">ç»¼åˆåˆ†ææŠ¥å‘Š</option>
                            <option value="summary">æ‘˜è¦æŠ¥å‘Š</option>
                            <option value="candidate_analysis">å€™é€‰äººåˆ†æ</option>
                            <option value="position_comparison">èŒä½å¯¹æ¯”</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="emailMessage">é™„åŠ è¯´æ˜</label>
                        <textarea id="emailMessage" rows="3" placeholder="è¯·æŸ¥æ”¶æœ€æ–°çš„æ‹›è˜æ•°æ®åˆ†ææŠ¥å‘Š..."></textarea>
                    </div>
                    <div class="email-actions">
                        <button type="button" class="btn-secondary" onclick="closeEmailModal()">å–æ¶ˆ</button>
                        <button type="submit" class="btn-primary">å‘é€æŠ¥å‘Š</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- PDF.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // é…ç½®PDF.js
        if (window.pdfjsLib) {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        }
    </script>
    <script src="js/pdf-viewer.js"></script>
    <script src="js/dashboard.js"></script>
    <script>
        // è°ƒè¯•è„šæœ¬ - ç›´æ¥æ›´æ–°æ•°æ®åˆ†æé¡µé¢
        console.log('Inline debug script loaded');
        
        async function debugUpdateAnalytics() {
            try {
                console.log('Fetching analytics data...');
                const response = await fetch('http://localhost:8000/api/dashboard/stats');
                console.log('Response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Analytics data:', data);
                    
                    // ç›´æ¥æ›´æ–°æœ€ä½³å€™é€‰äºº
                    const bestContainer = document.querySelector('.candidates-ranking');
                    if (bestContainer && data.best_candidates) {
                        console.log('Updating best candidates container');
                        bestContainer.innerHTML = data.best_candidates.map((item, index) => `
                            <div style="display: flex; align-items: center; padding: 15px; margin: 10px 0; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                <div style="width: 30px; height: 30px; background: #007bff; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-weight: bold;">
                                    ${index + 1}
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-weight: bold; font-size: 16px;">${item.candidate.name}</div>
                                    <div style="color: #666; font-size: 14px;">${item.candidate.position}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-weight: bold; color: #28a745;">${item.candidate.score ? item.candidate.score + ' åˆ†' : 'æœªè¯„åˆ†'}</div>
                                    <div style="font-size: 12px; color: #666;">${item.candidate.interview_date}</div>
                                </div>
                            </div>
                        `).join('');
                    }
                    
                    // ç›´æ¥æ›´æ–°æœ€ä½è–ªèµ„å€™é€‰äºº
                    const salaryContainer = document.querySelector('.salary-ranking');
                    if (salaryContainer && data.lowest_salary_candidates) {
                        console.log('Updating salary candidates container');
                        salaryContainer.innerHTML = data.lowest_salary_candidates.map((item, index) => `
                            <div style="display: flex; align-items: center; padding: 15px; margin: 10px 0; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                <div style="flex: 1;">
                                    <div style="font-weight: bold; font-size: 16px;">${item.candidate.name}</div>
                                    <div style="color: #666; font-size: 14px;">${item.candidate.position}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-weight: bold; color: #dc3545;">${item.candidate.expected_salary}</div>
                                    <div style="font-size: 12px; color: #666;">${item.candidate.score ? 'è¯„åˆ†: ' + item.candidate.score : 'æœªè¯„åˆ†'}</div>
                                </div>
                            </div>
                        `).join('');
                    }
                } else {
                    console.error('Failed to fetch analytics data');
                }
            } catch (error) {
                console.error('Debug update failed:', error);
            }
        }
        
        // ç›‘å¬æ ‡ç­¾åˆ‡æ¢ï¼Œå½“åˆ‡æ¢åˆ°analyticsæ—¶æ›´æ–°æ•°æ®
        document.addEventListener('DOMContentLoaded', function() {
            // é‡å†™switchTabå‡½æ•°æ¥åŒ…å«æˆ‘ä»¬çš„è°ƒè¯•æ›´æ–°
            const originalSwitchTab = window.switchTab;
            window.switchTab = function(tabName) {
                if (originalSwitchTab) {
                    originalSwitchTab(tabName);
                }
                if (tabName === 'analytics') {
                    setTimeout(debugUpdateAnalytics, 100); // å»¶è¿Ÿä¸€ç‚¹ç¡®ä¿DOMå·²æ›´æ–°
                }
            };
            
            // å¦‚æœå½“å‰å·²ç»åœ¨analyticsæ ‡ç­¾ï¼Œç«‹å³æ›´æ–°
            if (window.currentTab === 'analytics') {
                setTimeout(debugUpdateAnalytics, 500);
            }
        });
    </script>
</body>
</html>