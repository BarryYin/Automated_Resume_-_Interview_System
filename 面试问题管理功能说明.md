# 面试问题管理功能说明

## 功能概述

本次更新为AI招聘系统添加了完整的面试问题管理功能，包括：

1. ✅ 在候选人列表页展示AI生成的面试问题
2. ✅ 可以依据岗位和候选人简历信息重新生成新的问题
3. ✅ 管理员可以针对生成的问题提出修改意见，再次生成
4. ✅ 生成的问题会保存到数据库，候选人面试时使用保存的问题

## 功能详情

### 1. 候选人列表显示面试问题

在管理员控制台的候选人列表中，每个候选人卡片现在会显示：

- **面试问题按钮**：点击可查看该候选人的所有面试问题
- **问题状态标识**：如果已生成问题，会显示"已生成 X 个面试问题"和更新时间

### 2. 查看面试问题

点击候选人卡片上的"面试问题"按钮，会弹出模态框显示：

- **面试策略**：AI生成的整体面试策略建议
- **问题列表**：10个结构化的面试问题，包括：
  - 问题编号
  - 评估维度（专业知识、专业技能、综合能力、个性特质、求职动机、价值观）
  - 主要问题
  - 追问方向

### 3. 重新生成问题

在面试问题模态框中，管理员可以：

#### 方式一：直接重新生成
- 点击"重新生成问题"按钮
- AI会根据候选人简历和岗位要求重新生成10个问题
- 新问题会覆盖原有问题

#### 方式二：根据反馈重新生成
- 点击"提出修改意见"按钮
- 输入对当前问题的修改意见，例如：
  - "问题太简单，需要更深入考察候选人的实际项目经验"
  - "增加对AIGC技术理解的考察"
  - "减少理论知识，增加实践案例"
- AI会根据反馈意见调整问题的深度和方向
- 生成更符合要求的新问题

### 4. 面试时使用保存的问题

当候选人开始面试时：

1. 系统首先检查数据库中是否有该候选人的预生成问题
2. 如果有，直接使用保存的问题进行面试
3. 如果没有，则实时生成新问题

这样确保：
- 管理员精心调整的问题能够被使用
- 面试问题的一致性和针对性
- 提高面试效率

## 技术实现

### 后端API

#### 1. 获取候选人列表（含问题）
```
GET /api/candidates
```
返回所有候选人信息，包括每个候选人的面试问题状态

#### 2. 获取指定候选人的面试问题
```
GET /api/candidates/{candidate_id}/questions
```
返回该候选人的所有面试问题和策略

#### 3. 生成/重新生成面试问题
```
POST /api/candidates/{candidate_id}/generate-questions
```
请求体：
```json
{
  "candidate_id": 1,
  "candidate_name": "张三",
  "candidate_email": "zhangsan@example.com",
  "position": "Python工程师",
  "position_code": "1001",
  "feedback": "可选的管理员反馈意见"
}
```

### 数据库表结构

#### interview_questions 表
```sql
CREATE TABLE interview_questions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    candidate_name TEXT,
    candidate_email TEXT,
    position_code TEXT,
    questions_json TEXT,  -- JSON格式存储问题列表
    strategy TEXT,        -- 面试策略
    resume_path TEXT,     -- 简历文件路径
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)
```

### 前端功能

#### dashboard.js 新增函数

1. `showQuestionsModal()` - 显示面试问题模态框
2. `loadCandidateQuestions()` - 加载候选人问题
3. `regenerateQuestions()` - 重新生成问题
4. `regenerateWithFeedback()` - 根据反馈重新生成
5. `showNotification()` - 显示操作结果通知

#### interview.js 修改

- `generateInterviewQuestions()` 函数现在会优先从数据库加载保存的问题
- 如果数据库中没有问题，才会调用API生成新问题

## 使用流程

### 管理员操作流程

1. **查看候选人列表**
   - 登录管理员控制台
   - 切换到"候选人"标签页
   - 查看每个候选人的问题状态

2. **生成面试问题**
   - 点击候选人卡片上的"面试问题"按钮
   - 如果还没有问题，点击"重新生成问题"
   - 等待AI生成（约5-10秒）

3. **审核和调整问题**
   - 查看生成的10个问题
   - 如果不满意，点击"提出修改意见"
   - 输入具体的修改建议
   - 提交后AI会重新生成

4. **确认问题**
   - 确认问题满意后，关闭模态框
   - 问题已自动保存到数据库

### 候选人面试流程

1. **开始面试**
   - 候选人登录并开始面试
   - 系统自动加载管理员预设的问题

2. **回答问题**
   - 按顺序回答10个问题
   - AI实时评分和反馈

3. **完成面试**
   - 查看总体评分
   - 管理员可查看详细的问答记录

## 测试方法

### 使用测试页面

1. 打开 `test_questions_api.html` 文件
2. 依次测试各个功能：
   - 获取候选人列表
   - 获取指定候选人的问题
   - 生成新问题
   - 根据反馈重新生成

### 手动测试

1. 启动后端服务：
```bash
cd backend
python main.py
```

2. 打开前端页面：
```bash
# 在浏览器中打开
frontend/dashboard.html
```

3. 测试流程：
   - 登录管理员账号
   - 查看候选人列表
   - 点击"面试问题"按钮
   - 测试生成和重新生成功能

## 注意事项

1. **API密钥**：确保 `backend/llm_service.py` 中的百度文心大模型API密钥有效

2. **简历文件**：
   - 简历文件应放在 `resouse/` 目录下
   - 按职位分类存放
   - 文件名应包含候选人姓名

3. **数据库**：
   - 首次运行会自动创建 `interview_questions` 表
   - 问题以JSON格式存储
   - 支持多次更新

4. **性能**：
   - 生成问题需要调用LLM API，约需5-10秒
   - 建议提前为候选人生成问题
   - 避免在面试开始时才生成

## 未来改进方向

1. **批量生成**：支持一键为所有候选人生成问题
2. **问题模板**：支持保存和复用问题模板
3. **问题库**：建立常用问题库，快速组合
4. **多轮面试**：支持为同一候选人生成多轮面试问题
5. **问题评分**：管理员可以对问题质量进行评分和反馈

## 常见问题

### Q: 为什么生成问题失败？
A: 可能的原因：
- API密钥无效或过期
- 网络连接问题
- 简历文件读取失败
- 检查后端日志获取详细错误信息

### Q: 如何修改问题生成的逻辑？
A: 修改 `backend/llm_service.py` 中的 `generate_interview_questions()` 和 `regenerate_questions_with_feedback()` 函数

### Q: 候选人面试时会看到哪些问题？
A: 候选人会看到数据库中保存的最新版本的问题。如果管理员重新生成了问题，候选人下次面试时会使用新问题。

### Q: 可以为同一候选人生成多套问题吗？
A: 当前版本每个候选人只保存一套问题（最新的）。如需保存多套问题，需要修改数据库结构。

## 联系支持

如有问题或建议，请联系开发团队。
